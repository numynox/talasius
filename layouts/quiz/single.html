{{ define "main" }}

  <article id="quiz-article" 
    data-lat="{{ .Params.latitude }}" 
    data-lon="{{ .Params.longitude }}" 
    data-uncertainty="{{ .Params.uncertainty }}">
    <header class="flex flex-col sm:flex-row sm:items-center sm:justify-between">
      <div>
        {{ if .Params.showBreadcrumbs | default (site.Params.article.showBreadcrumbs | default false) }}
          {{ partial "breadcrumbs.html" . }}
        {{ end }}
        <h1 class="mt-3 sm:mt-0 text-4xl font-extrabold text-neutral-900 dark:text-neutral">{{ .Title }}</h1>
      </div>

      <div class="mt-3 sm:mt-0">
        <a href="{{ "quiz/" | relLangURL }}" class="back-to-list !rounded-md bg-primary-600 my-0 px-3 py-2 !text-neutral !no-underline hover:!bg-primary-500 dark:bg-primary-800 dark:hover:!bg-primary-700">
          {{ partial "icon.html" "list" }}
          <span class="ms-2">{{ i18n "quiz.back_to_list" }}</span>
        </a>
      </div>
    </header>

    <div class="quiz-two-column">
      {{/* Left column: Content */}}
      <div class="quiz-content">
        {{/* Unsolved state */}}
        <div id="unsolved-state">
          <p class="mb-5">{{ i18n "quiz.found_place_prompt" }}</p>

          {{/* Collapsible hint admonition */}}
          {{ with .Params.help }}
          <details class="admonition relative overflow-hidden rounded-lg border-l-4 my-3 px-4 py-3 shadow-sm group" data-type="tip">
            <summary class="flex items-center gap-2 font-semibold text-inherit capitalize cursor-pointer">
              <div class="flex shrink-0 h-5 w-5 items-center justify-center text-lg">
                {{ partial "icon.html" "lightbulb" }}
              </div>
              <div class="grow">
                {{ i18n "quiz.hint_title" }}
              </div>
              <div class="ms-auto flex h-5 w-5 items-center justify-center transition-transform ease-in-out -rotate-90 group-open:rotate-0 print:hidden">
                {{ partial "icon.html" "chevron-down" }}
              </div>
            </summary>
            <div class="admonition-content mt-3 text-base leading-relaxed text-inherit">
              {{ . | markdownify }}
            </div>
          </details>
          {{ end }}
          
          <button 
            id="quiz-solve-button"
            class="!rounded-md bg-primary-600 my-3 px-4 py-2 !text-neutral !no-underline hover:!bg-primary-500 dark:bg-primary-800 dark:hover:!bg-primary-700">
            {{ i18n "quiz.solve_button" }}
          </button>

          {{/* Error message display */}}
          <div id="quiz-error" 
            class="hidden admonition relative overflow-hidden rounded-lg border-l-4 my-3 px-4 py-3 shadow-sm" data-type="warning"
            data-error-no-gps="{{ i18n "quiz.error_no_gps" }}"
            data-error-denied="{{ i18n "quiz.error_denied" }}"
            data-error-unavailable="{{ i18n "quiz.error_unavailable" }}"
            data-error-timeout="{{ i18n "quiz.error_timeout" }}"
            data-error-generic="{{ i18n "quiz.error_generic" }}"
            data-error-too-far="{{ i18n "quiz.error_too_far" }}">
          </div>
        </div>

        {{/* Solved state (hidden by default; JS will reveal if solved) */}}
        <div id="solved-state" style="display:none;">
          <div class="admonition relative overflow-hidden rounded-lg border-l-4 mb-3 px-4 py-3 shadow-sm" data-type="success">
            <div class="flex items-center gap-2 font-semibold text-inherit capitalize">
              <div class="flex shrink-0 h-5 w-5 items-center justify-center text-lg">
                {{ partial "icon.html" "check" }}
              </div>
              <div class="grow">
                {{ i18n "quiz.solved_title" }}
              </div>
            </div>
            <div class="admonition-content mt-3 text-base leading-relaxed text-inherit">
              <p>{{ i18n "quiz.solved_message" }}</p>
              <p class="mt-2 text-sm text-neutral-600 dark:text-neutral-300">
                <span id="quiz-solved-datetime"></span>
                <span id="quiz-solved-sep" class="mx-2" style="display:none">â€¢</span>
                <span id="quiz-solved-attempts" class="ms-3" data-attempt-one="{{ i18n "quiz.attempt_one" }}" data-attempts-many="{{ i18n "quiz.attempts_many" }}"></span>
              </p>
            </div>
          </div>
          
          <div class="prose dark:prose-invert mt-4">
            {{ .Content }}
          </div>
        </div>
      </div>

      {{/* Right column: Picture */}}
      <div class="quiz-image">
        {{ partial "quiz-image.html" (dict "page" . "class" "w-full rounded-lg shadow-lg" "alt" $.Title "size" "1000") }}
      </div>
    </div>
  </article>

  {{/* Include quiz JavaScript */}}
  {{ $quiz := resources.Get "js/quiz.js" }}
  {{ if $quiz }}
    <script src="{{ $quiz.RelPermalink }}"></script>
  {{ end }}
{{ end }}
